<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ahmedabad Travel Planner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      font-family: "Poppins", sans-serif;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

  <div class="bg-white shadow-2xl rounded-2xl p-6 w-full max-w-md text-gray-800">
    <h1 class="text-2xl font-bold text-center text-blue-700 mb-4">
      Ahmedabad Travel Planner 🚆
    </h1>

    <!-- ⚠️ Desktop Alert -->
    <div id="device-warning" class="hidden bg-yellow-100 text-yellow-800 text-sm p-3 rounded-lg mb-3 text-center">
      ⚠️ For live booking (Uber/Ola/Rapido), open this site on your mobile device.
    </div>

    <!-- 📍 From/To Dropdowns -->
    <div class="mb-4">
      <label for="from" class="block font-semibold mb-1">From</label>
      <select id="from" class="w-full border border-gray-300 rounded-lg p-2">
        <option value="Sardar Vallabhbhai Patel International Airport, Ahmedabad">Ahmedabad Airport ✈️</option>
        <option value="AEC Metro Station, Ahmedabad">AEC Metro Station 🚇</option>
        <option value="Rajiv Nagar Metro Station, Ahmedabad">Rajiv Nagar Metro 🚇</option>
        <option value="Cephlon Inc, Ahmedabad">Cephlon Inc 🏢</option>
        <option value="Bhavya PG, Ahmedabad">Bhavya PG 🏠</option>
      </select>
    </div>

    <div class="mb-4">
      <label for="to" class="block font-semibold mb-1">To</label>
      <select id="to" class="w-full border border-gray-300 rounded-lg p-2">
        <option value="AEC Metro Station, Ahmedabad">AEC Metro Station 🚇</option>
        <option value="Rajiv Nagar Metro Station, Ahmedabad">Rajiv Nagar Metro 🚇</option>
        <option value="Cephlon Inc, Ahmedabad">Cephlon Inc 🏢</option>
        <option value="Sardar Vallabhbhai Patel International Airport, Ahmedabad">Ahmedabad Airport ✈️</option>
        <option value="Bhavya PG, Ahmedabad">Bhavya PG 🏠</option>
      </select>
    </div>

    <!-- 🔘 Action Buttons -->
    <div class="grid grid-cols-1 gap-2">
      <button id="showRoute" class="bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 text-center">Show Route on Map</button>
      <button id="bookUber" class="bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 text-center">Book with Uber</button>
      <button id="bookOla" class="bg-yellow-500 text-white py-2 rounded-lg hover:bg-yellow-600 text-center">Book with Ola(uses GPS)</button>
      <button id="bookRapido" class="bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 text-center">Book with Rapido(this app dont open automatically)</button>
    </div>

    <!-- 📊 Info -->
    <div id="route-info" class="mt-5 bg-gray-50 p-3 rounded-lg text-sm hidden">
      <p><b>From:</b> <span id="info-from"></span></p>
      <p><b>To:</b> <span id="info-to"></span></p>
      <p class="text-green-700 font-semibold mt-1">
        Live route will open in Google Maps
      </p>
    </div>

    <footer class="mt-6 text-center text-gray-400 text-xs">
      © 2025 Ahmedabad Transit Guide
    </footer>
  </div>

  <!-- 💡 JavaScript -->
<script>
  const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  if (!isMobile) {
    document.getElementById('device-warning').classList.remove('hidden');
  }

  const fromSelect = document.getElementById('from');
  const toSelect = document.getElementById('to');
  const routeInfo = document.getElementById('route-info');
  const infoFrom = document.getElementById('info-from');
  const infoTo = document.getElementById('info-to');

  // Helper to clean text
  function getAddress(val) {
    return encodeURIComponent(val.replace(/,/g, ''));
  }

  // 📍 Ask user for GPS location
  function getCurrentLocation(callback) {
    if (!navigator.geolocation) {
      alert("Your device does not support GPS or permission denied.");
      callback(null);
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        callback({ lat, lng });
      },
      () => {
        alert("Unable to get location — using selected 'From' place.");
        callback(null);
      }
    );
  }

  // Google Maps Route
  function openMaps() {
    const from = getAddress(fromSelect.value);
    const to = getAddress(toSelect.value);
    const mapsUrl = `https://www.google.com/maps/dir/?api=1&origin=${from}&destination=${to}`;
    infoFrom.textContent = fromSelect.options[fromSelect.selectedIndex].text;
    infoTo.textContent = toSelect.options[toSelect.selectedIndex].text;
    routeInfo.classList.remove('hidden');
    window.open(mapsUrl, '_blank');
  }

  // // 🚖 Uber deep link
  // function openUber() {
  //   if (confirm("📍 Use your GPS location as pickup?")) {
  //     getCurrentLocation((loc) => {
  //       const to = getAddress(toSelect.value);
  //       let uberUrl;
  //       if (loc) {
  //         uberUrl = `uber://?action=setPickup&pickup[latitude]=${loc.lat}&pickup[longitude]=${loc.lng}&dropoff[formatted_address]=${to}`;
  //       } else {
  //         const from = getAddress(fromSelect.value);
  //         uberUrl = `uber://?action=setPickup&pickup[formatted_address]=${from}&dropoff[formatted_address]=${to}`;
  //       }
  //       const uberWeb = uberUrl.replace("uber://", "https://m.uber.com/ul/");
  //       window.location.href = uberUrl;
  //       setTimeout(() => window.open(uberWeb, "_blank"), 1000);
  //     });
  //   } else {
  //     const from = getAddress(fromSelect.value);
  //     const to = getAddress(toSelect.value);
  //     const uberUrl = `uber://?action=setPickup&pickup[formatted_address]=${from}&dropoff[formatted_address]=${to}`;
  //     const uberWeb = `https://m.uber.com/ul/?action=setPickup&pickup[formatted_address]=${from}&dropoff[formatted_address]=${to}`;
  //     window.location.href = uberUrl;
  //     setTimeout(() => window.open(uberWeb, "_blank"), 1000);
  //   }
  // }

  // 🚖 Uber deep link (fixed GPS timing)
function openUber() {
  if (confirm("📍 Use your GPS location as pickup?")) {
    // Only proceed after GPS is ready
    getCurrentLocation((loc) => {
      const to = getAddress(toSelect.value);
      let uberUrl;
      if (loc && loc.lat && loc.lng) {
        uberUrl = `uber://?action=setPickup&pickup[latitude]=${loc.lat}&pickup[longitude]=${loc.lng}&dropoff[formatted_address]=${to}`;
      } else {
        // fallback if GPS fails
        const from = getAddress(fromSelect.value);
        uberUrl = `uber://?action=setPickup&pickup[formatted_address]=${from}&dropoff[formatted_address]=${to}`;
      }

      const uberWeb = uberUrl.replace("uber://", "https://m.uber.com/ul/");
      // open Uber
      window.location.href = uberUrl;
      // fallback after short delay if app not installed
      setTimeout(() => window.open(uberWeb, "_blank"), 1000);
    });
  } else {
    // Cancel path (no GPS) — keep original behavior
    const from = getAddress(fromSelect.value);
    const to = getAddress(toSelect.value);
    const uberUrl = `uber://?action=setPickup&pickup[formatted_address]=${from}&dropoff[formatted_address]=${to}`;
    const uberWeb = `https://m.uber.com/ul/?action=setPickup&pickup[formatted_address]=${from}&dropoff[formatted_address]=${to}`;
    window.location.href = uberUrl;
    setTimeout(() => window.open(uberWeb, "_blank"), 1000);
  }
}


// 🚗 Ola deep link (auto-GPS, with fallback)
function openOla() {
  const from = getAddress(fromSelect.value);
  const to = getAddress(toSelect.value);

  // Ola works better with plain text (not encoded)
  const olaUrl = `olacabs://app/launch?pickup_name=${from}&drop_name=${to}`;
  const olaWeb = "https://play.google.com/store/apps/details?id=com.olacabs.customer";

  try {
    // Try opening Ola app
    window.location.href = olaUrl;

    // Fallback: open Play Store if app not installed
    setTimeout(() => {
      window.open(olaWeb, "_blank");
    }, 1500);
  } catch (e) {
    window.open(olaWeb, "_blank");
  }
}

 // 🛵 Rapido deep link (with fallback)
function openRapido() {
  if (confirm("📍 Use your GPS location as pickup?")) {
    getCurrentLocation((loc) => {
      const to = getAddress(toSelect.value);
      const from = getAddress(fromSelect.value);

      let rapidoIntent = "";

      if (loc) {
        rapidoIntent = `intent://ride?pickup_lat=${loc.lat}&pickup_lng=${loc.lng}&drop_name=${encodeURIComponent(to)}#Intent;scheme=rapido;package=com.rapido.passenger;end`;
      } else {
        rapidoIntent = `intent://ride?pickup_name=${encodeURIComponent(from)}&drop_name=${encodeURIComponent(to)}#Intent;scheme=rapido;package=com.rapido.passenger;end`;
      }

      tryOpenRapido(rapidoIntent);
    });
  } else {
    const from = getAddress(fromSelect.value);
    const to = getAddress(toSelect.value);
    const rapidoIntent = `intent://ride?pickup_name=${encodeURIComponent(from)}&drop_name=${encodeURIComponent(to)}#Intent;scheme=rapido;package=com.rapido.passenger;end`;
    tryOpenRapido(rapidoIntent);
  }
}

// 🚀 Function to open Rapido app or fallback to Play Store
function tryOpenRapido(intentUrl) {
  const fallbackUrl = "https://play.google.com/store/apps/details?id=com.rapido.passenger";
  
  // Try opening the app
  window.location.href = intentUrl;

  // If user doesn’t have the app, fallback after delay
  setTimeout(() => {
    window.open(fallbackUrl, "_blank");
  }, 1500);
}


  // Event listeners
  document.getElementById('showRoute').addEventListener('click', openMaps);
  document.getElementById('bookUber').addEventListener('click', openUber);
  document.getElementById('bookOla').addEventListener('click', openOla);
  document.getElementById('bookRapido').addEventListener('click', openRapido);
</script>



</body>
</html>
